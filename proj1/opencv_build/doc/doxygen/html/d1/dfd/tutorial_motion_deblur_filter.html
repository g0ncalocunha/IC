<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>OpenCV: Motion Deblur Filter</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "ams.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0-dev</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d7/da8/tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Motion Deblur Filter </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md598">Goal</a></li>
<li class="level1"><a href="#autotoc_md599">Theory</a><ul><li class="level2"><a href="#autotoc_md600">What is the PSF of a motion blur image?</a></li>
<li class="level2"><a href="#autotoc_md601">How to restore a blurred image?</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md602">Source code</a></li>
<li class="level1"><a href="#autotoc_md603">Explanation</a></li>
<li class="level1"><a href="#autotoc_md604">Result</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__home_goncalo_MECT1_1_IC_proj1_opencv_4_x_doc_tutorials_imgproc_motion_deblur_filter_motion_deblur_filter"></a></p>
<p><b>Prev Tutorial:</b> <a class="el" href="../../de/d3c/tutorial_out_of_focus_deblur_filter.html">Out-of-focus Deblur Filter</a> <br  />
<b>Next Tutorial:</b> <a class="el" href="../../d4/d70/tutorial_anisotropic_image_segmentation_by_a_gst.html">Anisotropic image segmentation by a gradient structure tensor</a> <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight"></th><th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">Original author   </td><td class="markdownTableBodyLeft">Karpushin Vladislav    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">Compatibility   </td><td class="markdownTableBodyLeft">OpenCV &gt;= 3.0   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md598"></a>
Goal</h1>
<p>In this tutorial you will learn:</p>
<ul>
<li>what the PSF of a motion blur image is</li>
<li>how to restore a motion blur image</li>
</ul>
<h1><a class="anchor" id="autotoc_md599"></a>
Theory</h1>
<p>For the degradation image model theory and the Wiener filter theory you can refer to the tutorial <a class="el" href="../../de/d3c/tutorial_out_of_focus_deblur_filter.html">Out-of-focus Deblur Filter</a>. On this page only a linear motion blur distortion is considered. The motion blur image on this page is a real world image. The blur was caused by a moving subject.</p>
<h2><a class="anchor" id="autotoc_md600"></a>
What is the PSF of a motion blur image?</h2>
<p>The point spread function (PSF) of a linear motion blur distortion is a line segment. Such a PSF is specified by two parameters: \(LEN\) is the length of the blur and \(THETA\) is the angle of motion.</p>
<p><img src="../../motion_psf.png" alt="" class="inline" title="Point spread function of a linear motion blur distortion"/></p>
<h2><a class="anchor" id="autotoc_md601"></a>
How to restore a blurred image?</h2>
<p>On this page the Wiener filter is used as the restoration filter, for details you can refer to the tutorial <a class="el" href="../../de/d3c/tutorial_out_of_focus_deblur_filter.html">Out-of-focus Deblur Filter</a>. In order to synthesize the Wiener filter for a motion blur case, it needs to specify the signal-to-noise ratio ( \(SNR\)), \(LEN\) and \(THETA\) of the PSF.</p>
<h1><a class="anchor" id="autotoc_md602"></a>
Source code</h1>
<p>You can find source code in the <code>samples/cpp/tutorial_code/ImgProc/motion_deblur_filter/motion_deblur_filter.cpp</code> of the OpenCV source code library.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">opencv2/imgproc.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d6/d87/imgcodecs_8hpp.html">opencv2/imgcodecs.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> help();</div>
<div class="line"><span class="keywordtype">void</span> calcPSF(Mat&amp; outputImg, <a class="code" href="../../dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">Size</a> filterSize, <span class="keywordtype">int</span> len, <span class="keywordtype">double</span> theta);</div>
<div class="line"><span class="keywordtype">void</span> fftshift(<span class="keyword">const</span> Mat&amp; inputImg, Mat&amp; outputImg);</div>
<div class="line"><span class="keywordtype">void</span> filter2DFreq(<span class="keyword">const</span> Mat&amp; inputImg, Mat&amp; outputImg, <span class="keyword">const</span> Mat&amp; H);</div>
<div class="line"><span class="keywordtype">void</span> calcWnrFilter(<span class="keyword">const</span> Mat&amp; input_h_PSF, Mat&amp; output_G, <span class="keywordtype">double</span> nsr);</div>
<div class="line"><span class="keywordtype">void</span> edgetaper(<span class="keyword">const</span> Mat&amp; inputImg, Mat&amp; outputImg, <span class="keywordtype">double</span> gamma = 5.0, <span class="keywordtype">double</span> beta = 0.2);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a> keys =</div>
<div class="line"><span class="stringliteral">&quot;{help h usage ? |             | print this message             }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{image          |input.png    | input image name               }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{LEN            |125          | length of a motion             }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{THETA          |0            | angle of a motion in degrees   }&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;{SNR            |700          | signal to noise ratio          }&quot;</span></div>
<div class="line">;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    help();</div>
<div class="line">    CommandLineParser parser(argc, argv, keys);</div>
<div class="line">    <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">&quot;help&quot;</span>))</div>
<div class="line">    {</div>
<div class="line">        parser.printMessage();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> LEN = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;LEN&quot;</span>);</div>
<div class="line">    <span class="keywordtype">double</span> THETA = parser.get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;THETA&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> snr = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;SNR&quot;</span>);</div>
<div class="line">    <span class="keywordtype">string</span> strInFileName = parser.get&lt;<a class="code" href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">String</a>&gt;(<span class="stringliteral">&quot;image&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!parser.check())</div>
<div class="line">    {</div>
<div class="line">        parser.printErrors();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    Mat imgIn;</div>
<div class="line">    imgIn = <a class="code" href="../../d4/da8/group__imgcodecs.html#gacbaa02cffc4ec2422dfa2e24412a99e2">imread</a>(strInFileName, <a class="code" href="../../d8/d6a/group__imgcodecs__flags.html#gga61d9b0126a3e57d9277ac48327799c80ae29981cfc153d3b0cef5c0daeedd2125">IMREAD_GRAYSCALE</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (imgIn.empty()) <span class="comment">//check whether the image is loaded or not</span></div>
<div class="line">    {</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;ERROR : Image cannot be loaded..!!&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    Mat imgOut;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// it needs to process even image only</span></div>
<div class="line">    <a class="code" href="../../dc/d84/group__core__basic.html#ga11d95de507098e90bad732b9345402e8">Rect</a> roi = <a class="code" href="../../dc/d84/group__core__basic.html#ga11d95de507098e90bad732b9345402e8">Rect</a>(0, 0, imgIn.cols &amp; -2, imgIn.rows &amp; -2);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Hw calculation (start)</span></div>
<div class="line">    Mat Hw, h;</div>
<div class="line">    calcPSF(h, roi.size(), LEN, THETA);</div>
<div class="line">    calcWnrFilter(h, Hw, 1.0 / <span class="keywordtype">double</span>(snr));</div>
<div class="line">    <span class="comment">//Hw calculation (stop)</span></div>
<div class="line"> </div>
<div class="line">    imgIn.convertTo(imgIn, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>);</div>
<div class="line">    edgetaper(imgIn, imgIn);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// filtering (start)</span></div>
<div class="line">    filter2DFreq(imgIn(roi), imgOut, Hw);</div>
<div class="line">    <span class="comment">// filtering (stop)</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">    imgOut.convertTo(imgOut, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);</div>
<div class="line">    <a class="code" href="../../dc/d84/group__core__basic.html#ga766333b5fb9fea02d355fa0e0ffbf7ac">normalize</a>(imgOut, imgOut, 0, 255, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>);</div>
<div class="line">    <a class="code" href="../../d4/da8/group__imgcodecs.html#ga8ac397bd09e48851665edbe12aa28f25">imwrite</a>(<span class="stringliteral">&quot;result.jpg&quot;</span>, imgOut);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> help()</div>
<div class="line">{</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;2018-08-14&quot;</span> &lt;&lt; endl;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Motion_deblur_v2&quot;</span> &lt;&lt; endl;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;You will learn how to recover an image with motion blur distortion using a Wiener filter&quot;</span> &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> calcPSF(Mat&amp; outputImg, <a class="code" href="../../dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">Size</a> filterSize, <span class="keywordtype">int</span> len, <span class="keywordtype">double</span> theta)</div>
<div class="line">{</div>
<div class="line">    Mat h(filterSize, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line">    <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a> point(filterSize.width / 2, filterSize.height / 2);</div>
<div class="line">    <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga28b2267d35786f5f890ca167236cbc69">ellipse</a>(h, point, <a class="code" href="../../dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">Size</a>(0, <a class="code" href="../../db/de0/group__core__utils.html#ga085eca238176984a0b72df2818598d85">cvRound</a>(<span class="keywordtype">float</span>(len) / 2.0)), 90.0 - theta, 0, 360, <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(255), <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ggaf076ef45de481ac96e0ab3dc2c29a777a89c5f6beef080e6df347167f85e07b9e">FILLED</a>);</div>
<div class="line">    <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a> summa = <a class="code" href="../../d2/de8/group__core__array.html#ga716e10a2dd9e228e4d3c95818f106722">sum</a>(h);</div>
<div class="line">    outputImg = h / summa[0];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> fftshift(<span class="keyword">const</span> Mat&amp; inputImg, Mat&amp; outputImg)</div>
<div class="line">{</div>
<div class="line">    outputImg = inputImg.clone();</div>
<div class="line">    <span class="keywordtype">int</span> cx = outputImg.cols / 2;</div>
<div class="line">    <span class="keywordtype">int</span> cy = outputImg.rows / 2;</div>
<div class="line">    Mat q0(outputImg, <a class="code" href="../../dc/d84/group__core__basic.html#ga11d95de507098e90bad732b9345402e8">Rect</a>(0, 0, cx, cy));</div>
<div class="line">    Mat q1(outputImg, <a class="code" href="../../dc/d84/group__core__basic.html#ga11d95de507098e90bad732b9345402e8">Rect</a>(cx, 0, cx, cy));</div>
<div class="line">    Mat q2(outputImg, <a class="code" href="../../dc/d84/group__core__basic.html#ga11d95de507098e90bad732b9345402e8">Rect</a>(0, cy, cx, cy));</div>
<div class="line">    Mat q3(outputImg, <a class="code" href="../../dc/d84/group__core__basic.html#ga11d95de507098e90bad732b9345402e8">Rect</a>(cx, cy, cx, cy));</div>
<div class="line">    Mat tmp;</div>
<div class="line">    q0.copyTo(tmp);</div>
<div class="line">    q3.copyTo(q0);</div>
<div class="line">    tmp.copyTo(q3);</div>
<div class="line">    q1.copyTo(tmp);</div>
<div class="line">    q2.copyTo(q1);</div>
<div class="line">    tmp.copyTo(q2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> filter2DFreq(<span class="keyword">const</span> Mat&amp; inputImg, Mat&amp; outputImg, <span class="keyword">const</span> Mat&amp; H)</div>
<div class="line">{</div>
<div class="line">    Mat planes[2] = { Mat_&lt;float&gt;(inputImg.clone()), <a class="code" href="../../d3/d63/classcv_1_1Mat.html#a56daa006391a670e9cb0cd08e3168c99">Mat::zeros</a>(inputImg.size(), <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>) };</div>
<div class="line">    Mat complexI;</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(planes, 2, complexI);</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#gadd6cf9baf2b8b704a11b5f04aaf4f39d">dft</a>(complexI, complexI, <a class="code" href="../../d2/de8/group__core__array.html#ggaf4dde112b483b38175621befedda1f1ca74746fb171aa4bfc08ace28d73f52375">DFT_SCALE</a>);</div>
<div class="line"> </div>
<div class="line">    Mat planesH[2] = { Mat_&lt;float&gt;(H.clone()), <a class="code" href="../../d3/d63/classcv_1_1Mat.html#a56daa006391a670e9cb0cd08e3168c99">Mat::zeros</a>(H.size(), <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>) };</div>
<div class="line">    Mat complexH;</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(planesH, 2, complexH);</div>
<div class="line">    Mat complexIH;</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga3ab38646463c59bf0ce962a9d51db64f">mulSpectrums</a>(complexI, complexH, complexIH, 0);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#gaa708aa2d2e57a508f968eb0f69aa5ff1">idft</a>(complexIH, complexIH);</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga0547c7fed86152d7e9d0096029c8518a">split</a>(complexIH, planes);</div>
<div class="line">    outputImg = planes[0];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> calcWnrFilter(<span class="keyword">const</span> Mat&amp; input_h_PSF, Mat&amp; output_G, <span class="keywordtype">double</span> nsr)</div>
<div class="line">{</div>
<div class="line">    Mat h_PSF_shifted;</div>
<div class="line">    fftshift(input_h_PSF, h_PSF_shifted);</div>
<div class="line">    Mat planes[2] = { Mat_&lt;float&gt;(h_PSF_shifted.clone()), <a class="code" href="../../d3/d63/classcv_1_1Mat.html#a56daa006391a670e9cb0cd08e3168c99">Mat::zeros</a>(h_PSF_shifted.size(), <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>) };</div>
<div class="line">    Mat complexI;</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(planes, 2, complexI);</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#gadd6cf9baf2b8b704a11b5f04aaf4f39d">dft</a>(complexI, complexI);</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga0547c7fed86152d7e9d0096029c8518a">split</a>(complexI, planes);</div>
<div class="line">    Mat denom;</div>
<div class="line">    <a class="code" href="../../d7/dcc/group__core__utils__softfloat.html#ga8bc36646a43b82baa15f151a973fb0c5">pow</a>(<a class="code" href="../../d2/d75/namespacecv.html#af6df65b17fb11af6d34634b6dfa44683">abs</a>(planes[0]), 2, denom);</div>
<div class="line">    denom += nsr;</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga6db555d30115642fedae0cda05604874">divide</a>(planes[0], denom, output_G);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> edgetaper(<span class="keyword">const</span> Mat&amp; inputImg, Mat&amp; outputImg, <span class="keywordtype">double</span> gamma, <span class="keywordtype">double</span> beta)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> Nx = inputImg.cols;</div>
<div class="line">    <span class="keywordtype">int</span> Ny = inputImg.rows;</div>
<div class="line">    Mat w1(1, Nx, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line">    Mat w2(Ny, 1, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span>* p1 = w1.ptr&lt;<span class="keywordtype">float</span>&gt;(0);</div>
<div class="line">    <span class="keywordtype">float</span>* p2 = w2.ptr&lt;<span class="keywordtype">float</span>&gt;(0);</div>
<div class="line">    <span class="keywordtype">float</span> dx = float(2.0 * <a class="code" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a> / Nx);</div>
<div class="line">    <span class="keywordtype">float</span> x = float(-<a class="code" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Nx; i++)</div>
<div class="line">    {</div>
<div class="line">        p1[i] = float(0.5 * (<a class="code" href="../../d0/de1/group__core.html#ga1c3ad52668041ecd803d1c0fc0b643c8">tanh</a>((x + gamma / 2) / beta) - <a class="code" href="../../d0/de1/group__core.html#ga1c3ad52668041ecd803d1c0fc0b643c8">tanh</a>((x - gamma / 2) / beta)));</div>
<div class="line">        x += dx;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">float</span> dy = float(2.0 * <a class="code" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a> / Ny);</div>
<div class="line">    <span class="keywordtype">float</span> y = float(-<a class="code" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Ny; i++)</div>
<div class="line">    {</div>
<div class="line">        p2[i] = float(0.5 * (<a class="code" href="../../d0/de1/group__core.html#ga1c3ad52668041ecd803d1c0fc0b643c8">tanh</a>((y + gamma / 2) / beta) - <a class="code" href="../../d0/de1/group__core.html#ga1c3ad52668041ecd803d1c0fc0b643c8">tanh</a>((y - gamma / 2) / beta)));</div>
<div class="line">        y += dy;</div>
<div class="line">    }</div>
<div class="line">    Mat w = w2 * w1;</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga979d898a58d7f61c53003e162e7ad89f">multiply</a>(inputImg, w, outputImg);</div>
<div class="line">}</div>
<div class="ttc" id="aclasscv_1_1Mat_html_a56daa006391a670e9cb0cd08e3168c99"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#a56daa006391a670e9cb0cd08e3168c99">cv::Mat::zeros</a></div><div class="ttdeci">static CV_NODISCARD_STD MatExpr zeros(int rows, int cols, int type)</div><div class="ttdoc">Returns a zero array of the specified size and type.</div></div>
<div class="ttc" id="agroup__core__array_html_ga0547c7fed86152d7e9d0096029c8518a"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga0547c7fed86152d7e9d0096029c8518a">cv::split</a></div><div class="ttdeci">void split(const Mat &amp;src, Mat *mvbegin)</div><div class="ttdoc">Divides a multi-channel array into several single-channel arrays.</div></div>
<div class="ttc" id="agroup__core__array_html_ga3ab38646463c59bf0ce962a9d51db64f"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga3ab38646463c59bf0ce962a9d51db64f">cv::mulSpectrums</a></div><div class="ttdeci">void mulSpectrums(InputArray a, InputArray b, OutputArray c, int flags, bool conjB=false)</div><div class="ttdoc">Performs the per-element multiplication of two Fourier spectrums.</div></div>
<div class="ttc" id="agroup__core__array_html_ga6db555d30115642fedae0cda05604874"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga6db555d30115642fedae0cda05604874">cv::divide</a></div><div class="ttdeci">void divide(InputArray src1, InputArray src2, OutputArray dst, double scale=1, int dtype=-1)</div><div class="ttdoc">Performs per-element division of two arrays or a scalar by an array.</div></div>
<div class="ttc" id="agroup__core__array_html_ga716e10a2dd9e228e4d3c95818f106722"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga716e10a2dd9e228e4d3c95818f106722">cv::sum</a></div><div class="ttdeci">Scalar sum(InputArray src)</div><div class="ttdoc">Calculates the sum of array elements.</div></div>
<div class="ttc" id="agroup__core__array_html_ga7d7b4d6c6ee504b30a20b1680029c7b4"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">cv::merge</a></div><div class="ttdeci">void merge(const Mat *mv, size_t count, OutputArray dst)</div><div class="ttdoc">Creates one multi-channel array out of several single-channel ones.</div></div>
<div class="ttc" id="agroup__core__array_html_ga979d898a58d7f61c53003e162e7ad89f"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga979d898a58d7f61c53003e162e7ad89f">cv::multiply</a></div><div class="ttdeci">void multiply(InputArray src1, InputArray src2, OutputArray dst, double scale=1, int dtype=-1)</div><div class="ttdoc">Calculates the per-element scaled product of two arrays.</div></div>
<div class="ttc" id="agroup__core__array_html_gaa708aa2d2e57a508f968eb0f69aa5ff1"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gaa708aa2d2e57a508f968eb0f69aa5ff1">cv::idft</a></div><div class="ttdeci">void idft(InputArray src, OutputArray dst, int flags=0, int nonzeroRows=0)</div><div class="ttdoc">Calculates the inverse Discrete Fourier Transform of a 1D or 2D array.</div></div>
<div class="ttc" id="agroup__core__array_html_gadd6cf9baf2b8b704a11b5f04aaf4f39d"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gadd6cf9baf2b8b704a11b5f04aaf4f39d">cv::dft</a></div><div class="ttdeci">void dft(InputArray src, OutputArray dst, int flags=0, int nonzeroRows=0)</div><div class="ttdoc">Performs a forward or inverse Discrete Fourier transform of a 1D or 2D floating-point array.</div></div>
<div class="ttc" id="agroup__core__array_html_ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">cv::NORM_MINMAX</a></div><div class="ttdeci">@ NORM_MINMAX</div><div class="ttdoc">flag</div><div class="ttdef"><b>Definition:</b> base.hpp:207</div></div>
<div class="ttc" id="agroup__core__array_html_ggaf4dde112b483b38175621befedda1f1ca74746fb171aa4bfc08ace28d73f52375"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ggaf4dde112b483b38175621befedda1f1ca74746fb171aa4bfc08ace28d73f52375">cv::DFT_SCALE</a></div><div class="ttdeci">@ DFT_SCALE</div><div class="ttdef"><b>Definition:</b> base.hpp:231</div></div>
<div class="ttc" id="agroup__core__basic_html_ga11d95de507098e90bad732b9345402e8"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga11d95de507098e90bad732b9345402e8">cv::Rect</a></div><div class="ttdeci">Rect2i Rect</div><div class="ttdef"><b>Definition:</b> types.hpp:496</div></div>
<div class="ttc" id="agroup__core__basic_html_ga1e83eafb2d26b3c93f09e8338bcab192"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">cv::Point</a></div><div class="ttdeci">Point2i Point</div><div class="ttdef"><b>Definition:</b> types.hpp:209</div></div>
<div class="ttc" id="agroup__core__basic_html_ga1f6634802eeadfd7245bc75cf3e216c2"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga1f6634802eeadfd7245bc75cf3e216c2">cv::String</a></div><div class="ttdeci">std::string String</div><div class="ttdef"><b>Definition:</b> cvstd.hpp:149</div></div>
<div class="ttc" id="agroup__core__basic_html_ga346f563897249351a34549137c8532a0"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">cv::Size</a></div><div class="ttdeci">Size2i Size</div><div class="ttdef"><b>Definition:</b> types.hpp:370</div></div>
<div class="ttc" id="agroup__core__basic_html_ga599fe92e910c027be274233eccad7beb"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">cv::Scalar</a></div><div class="ttdeci">Scalar_&lt; double &gt; Scalar</div><div class="ttdef"><b>Definition:</b> types.hpp:709</div></div>
<div class="ttc" id="agroup__core__basic_html_ga766333b5fb9fea02d355fa0e0ffbf7ac"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga766333b5fb9fea02d355fa0e0ffbf7ac">cv::normalize</a></div><div class="ttdeci">Vec&lt; _Tp, cn &gt; normalize(const Vec&lt; _Tp, cn &gt; &amp;v)</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga32b18d904ee2b1731a9416a8eef67d06"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a></div><div class="ttdeci">#define CV_8U</div><div class="ttdef"><b>Definition:</b> interface.h:73</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga4a3def5d72b74bed31f5f8ab7676099c"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a></div><div class="ttdeci">#define CV_32F</div><div class="ttdef"><b>Definition:</b> interface.h:78</div></div>
<div class="ttc" id="agroup__core__utils__softfloat_html_ga8bc36646a43b82baa15f151a973fb0c5"><div class="ttname"><a href="../../d7/dcc/group__core__utils__softfloat.html#ga8bc36646a43b82baa15f151a973fb0c5">cv::pow</a></div><div class="ttdeci">softfloat pow(const softfloat &amp;a, const softfloat &amp;b)</div><div class="ttdoc">Raising to the power.</div></div>
<div class="ttc" id="agroup__core__utils_html_ga085eca238176984a0b72df2818598d85"><div class="ttname"><a href="../../db/de0/group__core__utils.html#ga085eca238176984a0b72df2818598d85">cvRound</a></div><div class="ttdeci">int cvRound(double value)</div><div class="ttdoc">Rounds floating-point number to the nearest integer.</div><div class="ttdef"><b>Definition:</b> fast_math.hpp:200</div></div>
<div class="ttc" id="agroup__core__utils_html_ga677b89fae9308b340ddaebf0dba8455f"><div class="ttname"><a href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a></div><div class="ttdeci">#define CV_PI</div><div class="ttdef"><b>Definition:</b> cvdef.h:380</div></div>
<div class="ttc" id="agroup__core_html_ga1c3ad52668041ecd803d1c0fc0b643c8"><div class="ttname"><a href="../../d0/de1/group__core.html#ga1c3ad52668041ecd803d1c0fc0b643c8">cv::tanh</a></div><div class="ttdeci">Quat&lt; T &gt; tanh(const Quat&lt; T &gt; &amp;q)</div></div>
<div class="ttc" id="agroup__imgcodecs__flags_html_gga61d9b0126a3e57d9277ac48327799c80ae29981cfc153d3b0cef5c0daeedd2125"><div class="ttname"><a href="../../d8/d6a/group__imgcodecs__flags.html#gga61d9b0126a3e57d9277ac48327799c80ae29981cfc153d3b0cef5c0daeedd2125">cv::IMREAD_GRAYSCALE</a></div><div class="ttdeci">@ IMREAD_GRAYSCALE</div><div class="ttdoc">If set, always convert image to the single channel grayscale image (codec internal conversion).</div><div class="ttdef"><b>Definition:</b> imgcodecs.hpp:70</div></div>
<div class="ttc" id="agroup__imgcodecs_html_ga8ac397bd09e48851665edbe12aa28f25"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#ga8ac397bd09e48851665edbe12aa28f25">cv::imwrite</a></div><div class="ttdeci">CV_EXPORTS_W bool imwrite(const String &amp;filename, InputArray img, const std::vector&lt; int &gt; &amp;params=std::vector&lt; int &gt;())</div><div class="ttdoc">Saves an image to a specified file.</div></div>
<div class="ttc" id="agroup__imgcodecs_html_gacbaa02cffc4ec2422dfa2e24412a99e2"><div class="ttname"><a href="../../d4/da8/group__imgcodecs.html#gacbaa02cffc4ec2422dfa2e24412a99e2">cv::imread</a></div><div class="ttdeci">CV_EXPORTS_W Mat imread(const String &amp;filename, int flags=IMREAD_COLOR_BGR)</div><div class="ttdoc">Loads an image from a file.</div></div>
<div class="ttc" id="agroup__imgproc__draw_html_ga28b2267d35786f5f890ca167236cbc69"><div class="ttname"><a href="../../d6/d6e/group__imgproc__draw.html#ga28b2267d35786f5f890ca167236cbc69">cv::ellipse</a></div><div class="ttdeci">void ellipse(InputOutputArray img, Point center, Size axes, double angle, double startAngle, double endAngle, const Scalar &amp;color, int thickness=1, int lineType=LINE_8, int shift=0)</div><div class="ttdoc">Draws a simple or thick elliptic arc or fills an ellipse sector.</div></div>
<div class="ttc" id="agroup__imgproc__draw_html_ggaf076ef45de481ac96e0ab3dc2c29a777a89c5f6beef080e6df347167f85e07b9e"><div class="ttname"><a href="../../d6/d6e/group__imgproc__draw.html#ggaf076ef45de481ac96e0ab3dc2c29a777a89c5f6beef080e6df347167f85e07b9e">cv::FILLED</a></div><div class="ttdeci">@ FILLED</div><div class="ttdef"><b>Definition:</b> imgproc.hpp:891</div></div>
<div class="ttc" id="ahighgui__qt_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> highgui_qt.cpp:3</div></div>
<div class="ttc" id="aimgcodecs_8hpp_html"><div class="ttname"><a href="../../d6/d87/imgcodecs_8hpp.html">imgcodecs.hpp</a></div></div>
<div class="ttc" id="aimgproc_2include_2opencv2_2imgproc_8hpp_html"><div class="ttname"><a href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="anamespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdoc">&quot;black box&quot; representation of the file storage associated with a file on disk.</div><div class="ttdef"><b>Definition:</b> affine.hpp:52</div></div>
<div class="ttc" id="anamespacecv_html_af6df65b17fb11af6d34634b6dfa44683"><div class="ttname"><a href="../../d2/d75/namespacecv.html#af6df65b17fb11af6d34634b6dfa44683">cv::abs</a></div><div class="ttdeci">static uchar abs(uchar a)</div><div class="ttdef"><b>Definition:</b> cvstd.hpp:66</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md603"></a>
Explanation</h1>
<p>A motion blur image recovering algorithm consists of PSF generation, Wiener filter generation and filtering a blurred image in a frequency domain: </p><div class="fragment"><div class="line">    <span class="comment">// it needs to process even image only</span></div>
<div class="line">    <a class="code" href="../../dc/d84/group__core__basic.html#ga11d95de507098e90bad732b9345402e8">Rect</a> roi = <a class="code" href="../../dc/d84/group__core__basic.html#ga11d95de507098e90bad732b9345402e8">Rect</a>(0, 0, imgIn.cols &amp; -2, imgIn.rows &amp; -2);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Hw calculation (start)</span></div>
<div class="line">    Mat Hw, h;</div>
<div class="line">    calcPSF(h, roi.size(), LEN, THETA);</div>
<div class="line">    calcWnrFilter(h, Hw, 1.0 / <span class="keywordtype">double</span>(snr));</div>
<div class="line">    <span class="comment">//Hw calculation (stop)</span></div>
<div class="line"> </div>
<div class="line">    imgIn.convertTo(imgIn, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>);</div>
<div class="line">    edgetaper(imgIn, imgIn);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// filtering (start)</span></div>
<div class="line">    filter2DFreq(imgIn(roi), imgOut, Hw);</div>
<div class="line">    <span class="comment">// filtering (stop)</span></div>
</div><!-- fragment --><p> A function calcPSF() forms a PSF according to input parameters \(LEN\) and \(THETA\) (in degrees): </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> calcPSF(Mat&amp; outputImg, <a class="code" href="../../dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">Size</a> filterSize, <span class="keywordtype">int</span> len, <span class="keywordtype">double</span> theta)</div>
<div class="line">{</div>
<div class="line">    Mat h(filterSize, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line">    <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a> point(filterSize.width / 2, filterSize.height / 2);</div>
<div class="line">    <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga28b2267d35786f5f890ca167236cbc69">ellipse</a>(h, point, <a class="code" href="../../dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">Size</a>(0, <a class="code" href="../../db/de0/group__core__utils.html#ga085eca238176984a0b72df2818598d85">cvRound</a>(<span class="keywordtype">float</span>(len) / 2.0)), 90.0 - theta, 0, 360, <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(255), <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ggaf076ef45de481ac96e0ab3dc2c29a777a89c5f6beef080e6df347167f85e07b9e">FILLED</a>);</div>
<div class="line">    <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a> summa = <a class="code" href="../../d2/de8/group__core__array.html#ga716e10a2dd9e228e4d3c95818f106722">sum</a>(h);</div>
<div class="line">    outputImg = h / summa[0];</div>
<div class="line">}</div>
</div><!-- fragment --><p> A function edgetaper() tapers the input image’s edges in order to reduce the ringing effect in a restored image: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> edgetaper(<span class="keyword">const</span> Mat&amp; inputImg, Mat&amp; outputImg, <span class="keywordtype">double</span> gamma, <span class="keywordtype">double</span> beta)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> Nx = inputImg.cols;</div>
<div class="line">    <span class="keywordtype">int</span> Ny = inputImg.rows;</div>
<div class="line">    Mat w1(1, Nx, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line">    Mat w2(Ny, 1, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span>* p1 = w1.ptr&lt;<span class="keywordtype">float</span>&gt;(0);</div>
<div class="line">    <span class="keywordtype">float</span>* p2 = w2.ptr&lt;<span class="keywordtype">float</span>&gt;(0);</div>
<div class="line">    <span class="keywordtype">float</span> dx = float(2.0 * <a class="code" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a> / Nx);</div>
<div class="line">    <span class="keywordtype">float</span> x = float(-<a class="code" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Nx; i++)</div>
<div class="line">    {</div>
<div class="line">        p1[i] = float(0.5 * (<a class="code" href="../../d0/de1/group__core.html#ga1c3ad52668041ecd803d1c0fc0b643c8">tanh</a>((x + gamma / 2) / beta) - <a class="code" href="../../d0/de1/group__core.html#ga1c3ad52668041ecd803d1c0fc0b643c8">tanh</a>((x - gamma / 2) / beta)));</div>
<div class="line">        x += dx;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">float</span> dy = float(2.0 * <a class="code" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a> / Ny);</div>
<div class="line">    <span class="keywordtype">float</span> y = float(-<a class="code" href="../../db/de0/group__core__utils.html#ga677b89fae9308b340ddaebf0dba8455f">CV_PI</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Ny; i++)</div>
<div class="line">    {</div>
<div class="line">        p2[i] = float(0.5 * (<a class="code" href="../../d0/de1/group__core.html#ga1c3ad52668041ecd803d1c0fc0b643c8">tanh</a>((y + gamma / 2) / beta) - <a class="code" href="../../d0/de1/group__core.html#ga1c3ad52668041ecd803d1c0fc0b643c8">tanh</a>((y - gamma / 2) / beta)));</div>
<div class="line">        y += dy;</div>
<div class="line">    }</div>
<div class="line">    Mat w = w2 * w1;</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga979d898a58d7f61c53003e162e7ad89f">multiply</a>(inputImg, w, outputImg);</div>
<div class="line">}</div>
</div><!-- fragment --><p> The functions calcWnrFilter(), fftshift() and filter2DFreq() realize an image filtration by a specified PSF in the frequency domain. The functions are copied from the tutorial <a class="el" href="../../de/d3c/tutorial_out_of_focus_deblur_filter.html">Out-of-focus Deblur Filter</a>.</p>
<h1><a class="anchor" id="autotoc_md604"></a>
Result</h1>
<p>Below you can see the real world image with motion blur distortion. The license plate is not readable on both cars. The red markers show the car’s license plate location. <img src="../../motion_original.jpg" alt="" class="inline" title="Motion blur image. The license plates are not readable"/></p>
<p>Below you can see the restoration result for the black car license plate. The result has been computed with \(LEN\) = 125, \(THETA\) = 0, \(SNR\) = 700. <img src="../../black_car.jpg" alt="" class="inline" title="The restored image of the black car license plate"/></p>
<p>Below you can see the restoration result for the white car license plate. The result has been computed with \(LEN\) = 78, \(THETA\) = 15, \(SNR\) = 300. <img src="../../white_car.jpg" alt="" class="inline" title="The restored image of the white car license plate"/></p>
<p>The values of \(SNR\), \(LEN\) and \(THETA\) were selected manually to give the best possible visual result. The \(THETA\) parameter coincides with the car’s moving direction, and the \(LEN\) parameter depends on the car’s moving speed. The result is not perfect, but at least it gives us a hint of the image’s content. With some effort, the car license plate is now readable.</p>
<dl class="section note"><dt>Note</dt><dd>The parameters \(LEN\) and \(THETA\) are the most important. You should adjust \(LEN\) and \(THETA\) first, then \(SNR\).</dd></dl>
<p>You can also find a quick video demonstration of a license plate recovering method <a href="https://youtu.be/xSrE0hdhb4o">YouTube</a>. </p><div align='center'><iframe title='Video' width='560' height='349' src='https://www.youtube.com/embed/xSrE0hdhb4o?rel=0' frameborder='0' align='middle' allowfullscreen></iframe></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.1
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
