<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>OpenCV: Using Orbbec 3D cameras (UVC)</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "ams.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.10.0-dev</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../de/d3d/tutorial_table_of_content_app.html">Application utils (highgui, imgcodecs, videoio modules)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Using Orbbec 3D cameras (UVC) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md78">Introduction</a></li>
<li class="level2"><a href="#autotoc_md79">Instructions</a></li>
</ul>
<li class="level1"><a href="#autotoc_md80">Code</a><ul><li class="level2"><a href="#autotoc_md81">Code Explanation</a><ul><li class="level3"><a href="#autotoc_md82">Python</a></li>
<li class="level3"><a href="#autotoc_md83">C++</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md84">Results</a><ul><li class="level3"><a href="#autotoc_md85">Python</a></li>
<li class="level3"><a href="#autotoc_md86">C++</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md87">Note</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__home_goncalo_MECT1_1_IC_proj1_opencv_4_x_doc_tutorials_app_orbbec_uvc"></a></p>
<p><b>Prev Tutorial:</b> <a class="el" href="../../d0/db6/tutorial_orbbec_astra_openni.html">Using Orbbec Astra 3D cameras</a> <br  />
<b>Next Tutorial:</b> <a class="el" href="../../db/d08/tutorial_intelperc.html">Using Creative Senz3D and other Intel RealSense SDK compatible depth sensors</a> <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight"></th><th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">Original author   </td><td class="markdownTableBodyLeft">Jinyue Chen    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">Compatibility   </td><td class="markdownTableBodyLeft">OpenCV &gt;= 4.10   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md78"></a>
Introduction</h2>
<p>This tutorial is devoted to the Orbbec 3D cameras based on UVC protocol. For the use of the older Orbbec 3D cameras which depends on OpenNI, please refer to the <a href="https://github.com/opencv/opencv/blob/4.x/doc/tutorials/app/orbbec_astra_openni.markdown">previous tutorial</a>.</p>
<p>Unlike working with the OpenNI based Astra 3D cameras which requires OpenCV built with OpenNI2 SDK, Orbbec SDK is not required to be installed for accessing Orbbec UVC 3D cameras via OpenCV. By using <code><a class="el" href="../../d8/dfe/classcv_1_1VideoCapture.html" title="Class for video capturing from video files, image sequences or cameras.">cv::VideoCapture</a></code> class, users get the stream data from 3D cameras, similar to working with USB cameras. The calibration and alignment of the depth map and color image are done internally.</p>
<h2><a class="anchor" id="autotoc_md79"></a>
Instructions</h2>
<p>In order to use the 3D cameras with OpenCV. You can refer to <a href="https://opencv.org/get-started/">Get Started</a> to install OpenCV.</p>
<p>Note since 4.11 on, Mac OS users need to compile OpenCV from source with flag <code>-DOBSENSOR_USE_ORBBEC_SDK=ON</code> in order to use the cameras: </p><div class="fragment"><div class="line">cmake -DOBSENSOR_USE_ORBBEC_SDK=ON ..</div>
<div class="line">make</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md80"></a>
Code</h1>
 <div class='newInnerHTML' title='python' style='display: none;'>Python</div><div class='toggleable_div label_python' style='display: none;'><p> This tutorial code's is shown lines below. You can also download it from <a href="https://github.com/opencv/opencv/blob/4.x/samples/python/videocapture_obsensor.py">here</a> </p><div class="fragment"><div class="line"><span class="comment">#!/usr/bin/env python</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> sys</div>
<div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span><a class="code" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>():</div>
<div class="line">    <span class="comment"># Open Orbbec depth sensor</span></div>
<div class="line">    orbbec_cap = <a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html">cv.VideoCapture</a>(0, cv.CAP_OBSENSOR)</div>
<div class="line">    <span class="keywordflow">if</span> orbbec_cap.isOpened() == <span class="keyword">False</span>:</div>
<div class="line">        sys.exit(<span class="stringliteral">&quot;Fail to open camera.&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line">        <span class="comment"># Grab data from the camera</span></div>
<div class="line">        <span class="keywordflow">if</span> orbbec_cap.grab():</div>
<div class="line">            <span class="comment"># RGB data</span></div>
<div class="line">            ret_bgr, bgr_image = orbbec_cap.retrieve(<span class="keywordtype">None</span>, cv.CAP_OBSENSOR_BGR_IMAGE)</div>
<div class="line">            <span class="keywordflow">if</span> ret_bgr:</div>
<div class="line">                <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(<span class="stringliteral">&quot;BGR&quot;</span>, bgr_image)</div>
<div class="line"> </div>
<div class="line">            <span class="comment"># depth data</span></div>
<div class="line">            ret_depth, depth_map = orbbec_cap.retrieve(<span class="keywordtype">None</span>, cv.CAP_OBSENSOR_DEPTH_MAP)</div>
<div class="line">            <span class="keywordflow">if</span> ret_depth:</div>
<div class="line">                color_depth_map = <a class="code" href="../../dc/d84/group__core__basic.html#ga766333b5fb9fea02d355fa0e0ffbf7ac">cv.normalize</a>(depth_map, <span class="keywordtype">None</span>, 0, 255, cv.NORM_MINMAX, cv.CV_8UC1)</div>
<div class="line">                color_depth_map = <a class="code" href="../../d3/d50/group__imgproc__colormap.html#gadf478a5e5ff49d8aa24e726ea6f65d15">cv.applyColorMap</a>(color_depth_map, cv.COLORMAP_JET)</div>
<div class="line">                <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv.imshow</a>(<span class="stringliteral">&quot;DEPTH&quot;</span>, color_depth_map)</div>
<div class="line">        <span class="keywordflow">else</span>:</div>
<div class="line">            <a class="code" href="../../df/d57/namespacecv_1_1dnn.html#a43417dcaeb3c1e2a09b9d948e234c366">print</a>(<span class="stringliteral">&quot;Fail to grab data from the camera.&quot;</span>)</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> <a class="code" href="../../d7/dfc/group__highgui.html#ga6d20fbd3100ec3badc1eaa653aff99d7">cv.pollKey</a>() &gt;= 0:</div>
<div class="line">            <span class="keywordflow">break</span></div>
<div class="line"> </div>
<div class="line">    orbbec_cap.release()</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:</div>
<div class="line">    <a class="code" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>()</div>
<div class="ttc" id="aclasscv_1_1VideoCapture_html"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html">cv::VideoCapture</a></div><div class="ttdoc">Class for video capturing from video files, image sequences or cameras.</div><div class="ttdef"><b>Definition:</b> videoio.hpp:735</div></div>
<div class="ttc" id="agroup__core__basic_html_ga766333b5fb9fea02d355fa0e0ffbf7ac"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga766333b5fb9fea02d355fa0e0ffbf7ac">cv::normalize</a></div><div class="ttdeci">Vec&lt; _Tp, cn &gt; normalize(const Vec&lt; _Tp, cn &gt; &amp;v)</div></div>
<div class="ttc" id="agroup__highgui_html_ga453d42fe4cb60e5723281a89973ee563"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a></div><div class="ttdeci">void imshow(const String &amp;winname, InputArray mat)</div><div class="ttdoc">Displays an image in the specified window.</div></div>
<div class="ttc" id="agroup__highgui_html_ga6d20fbd3100ec3badc1eaa653aff99d7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga6d20fbd3100ec3badc1eaa653aff99d7">cv::pollKey</a></div><div class="ttdeci">int pollKey()</div><div class="ttdoc">Polls for a pressed key.</div></div>
<div class="ttc" id="agroup__imgproc__colormap_html_gadf478a5e5ff49d8aa24e726ea6f65d15"><div class="ttname"><a href="../../d3/d50/group__imgproc__colormap.html#gadf478a5e5ff49d8aa24e726ea6f65d15">cv::applyColorMap</a></div><div class="ttdeci">void applyColorMap(InputArray src, OutputArray dst, int colormap)</div><div class="ttdoc">Applies a GNU Octave/MATLAB equivalent colormap on a given image.</div></div>
<div class="ttc" id="ahighgui__qt_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> highgui_qt.cpp:3</div></div>
<div class="ttc" id="anamespacecv_1_1dnn_html_a43417dcaeb3c1e2a09b9d948e234c366"><div class="ttname"><a href="../../df/d57/namespacecv_1_1dnn.html#a43417dcaeb3c1e2a09b9d948e234c366">cv::dnn::print</a></div><div class="ttdeci">static void print(const std::vector&lt; _Tp &gt; &amp;shape, const String &amp;name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> shape_utils.hpp:228</div></div>
</div><!-- fragment -->  </div>  <div class='newInnerHTML' title='cpp' style='display: none;'>C++</div><div class='toggleable_div label_cpp' style='display: none;'><p> This tutorial code's is shown lines below. You can also download it from <a href="https://github.com/opencv/opencv/blob/4.x/samples/cpp/videocapture_obsensor.cpp">here</a> </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dc/d3d/videoio_8hpp.html">opencv2/videoio.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">opencv2/imgproc.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>()</div>
<div class="line">{</div>
<div class="line">    VideoCapture obsensorCapture(0, <a class="code" href="../../d4/d15/group__videoio__flags__base.html#gga023786be1ee68a9105bf2e48c700294da38a8d4494036d9a1cc3227dee9189755">CAP_OBSENSOR</a>);</div>
<div class="line">    <span class="keywordflow">if</span>(!obsensorCapture.isOpened()){</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to open obsensor capture! Index out of range or no response from device&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> fx = obsensorCapture.get(<a class="code" href="../../dc/dfc/group__videoio__flags__others.html#gga2ff9f67357f1cb986aaebe6df07609c0aa6349f9f91b3a6d1c694cb9d2ce5f300">CAP_PROP_OBSENSOR_INTRINSIC_FX</a>);</div>
<div class="line">    <span class="keywordtype">double</span> fy = obsensorCapture.get(<a class="code" href="../../dc/dfc/group__videoio__flags__others.html#gga2ff9f67357f1cb986aaebe6df07609c0a12a6e2e3565fe407ced536bbe97b9df8">CAP_PROP_OBSENSOR_INTRINSIC_FY</a>);</div>
<div class="line">    <span class="keywordtype">double</span> cx = obsensorCapture.get(<a class="code" href="../../dc/dfc/group__videoio__flags__others.html#gga2ff9f67357f1cb986aaebe6df07609c0a14ae456d33d9c7a3504c20a9b732d73d">CAP_PROP_OBSENSOR_INTRINSIC_CX</a>);</div>
<div class="line">    <span class="keywordtype">double</span> cy = obsensorCapture.get(<a class="code" href="../../dc/dfc/group__videoio__flags__others.html#gga2ff9f67357f1cb986aaebe6df07609c0a7900cc86b5736aa1d92ddec0b17aaf10">CAP_PROP_OBSENSOR_INTRINSIC_CY</a>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;obsensor camera intrinsic params: fx=&quot;</span> &lt;&lt; fx &lt;&lt; <span class="stringliteral">&quot;, fy=&quot;</span> &lt;&lt; fy &lt;&lt; <span class="stringliteral">&quot;, cx=&quot;</span> &lt;&lt; cx &lt;&lt; <span class="stringliteral">&quot;, cy=&quot;</span> &lt;&lt; cy &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    Mat image;</div>
<div class="line">    Mat depthMap;</div>
<div class="line">    Mat adjDepthMap;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Minimum depth value</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> minVal = 300;</div>
<div class="line">    <span class="comment">// Maximum depth value</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> maxVal = 5000;</div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Grab depth map like this:</span></div>
<div class="line">        <span class="comment">// obsensorCapture &gt;&gt; depthMap;</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Another way to grab depth map (and bgr image).</span></div>
<div class="line">        <span class="keywordflow">if</span> (obsensorCapture.grab())</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (obsensorCapture.retrieve(image, <a class="code" href="../../dc/dfc/group__videoio__flags__others.html#gga8fe46fdad857ac6af313a35209995686a4ad7df0545b33819550da2949c996bf4">CAP_OBSENSOR_BGR_IMAGE</a>))</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;RGB&quot;</span>, image);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (obsensorCapture.retrieve(depthMap, <a class="code" href="../../dc/dfc/group__videoio__flags__others.html#gga8fe46fdad857ac6af313a35209995686ad4631abb061c47f1508f3cbb304ddfcd">CAP_OBSENSOR_DEPTH_MAP</a>))</div>
<div class="line">            {</div>
<div class="line">                depthMap.convertTo(adjDepthMap, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>, 255.0 / (maxVal - minVal), -minVal * 255.0 / (maxVal - minVal));</div>
<div class="line">                <a class="code" href="../../d3/d50/group__imgproc__colormap.html#gadf478a5e5ff49d8aa24e726ea6f65d15">applyColorMap</a>(adjDepthMap, adjDepthMap, <a class="code" href="../../d3/d50/group__imgproc__colormap.html#gga9a805d8262bcbe273f16be9ea2055a65ab3f207661ddf74511b002b1acda5ec09">COLORMAP_JET</a>);</div>
<div class="line">                <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;DEPTH&quot;</span>, adjDepthMap);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// depth map overlay on bgr image</span></div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> alpha = 0.6f;</div>
<div class="line">            <span class="keywordflow">if</span> (!image.empty() &amp;&amp; !depthMap.empty())</div>
<div class="line">            {</div>
<div class="line">                depthMap.convertTo(adjDepthMap, <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>, 255.0 / (maxVal - minVal), -minVal * 255.0 / (maxVal - minVal));</div>
<div class="line">                <a class="code" href="../../da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">cv::resize</a>(adjDepthMap, adjDepthMap, <a class="code" href="../../d6/d50/classcv_1_1Size__.html">cv::Size</a>(image.cols, image.rows));</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; image.rows; i++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; image.cols; j++)</div>
<div class="line">                    {</div>
<div class="line">                        <a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>&amp; outRgb = image.at&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec3b</a>&gt;(i, j);</div>
<div class="line">                        uint8_t depthValue = 255 - adjDepthMap.at&lt;uint8_t&gt;(i, j);</div>
<div class="line">                        <span class="keywordflow">if</span> (depthValue != 0 &amp;&amp; depthValue != 255)</div>
<div class="line">                        {</div>
<div class="line">                            outRgb[0] = (uint8_t)(outRgb[0] * (1.0f - alpha) + depthValue * alpha);</div>
<div class="line">                            outRgb[1] = (uint8_t)(outRgb[1] * (1.0f - alpha) + depthValue *  alpha);</div>
<div class="line">                            outRgb[2] = (uint8_t)(outRgb[2] * (1.0f - alpha) + depthValue *  alpha);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;DepthToColor&quot;</span>, image);</div>
<div class="line">            }</div>
<div class="line">            image.release();</div>
<div class="line">            depthMap.release();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfc/group__highgui.html#ga6d20fbd3100ec3badc1eaa653aff99d7">pollKey</a>() &gt;= 0)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclasscv_1_1Size___html"><div class="ttname"><a href="../../d6/d50/classcv_1_1Size__.html">cv::Size_</a></div><div class="ttdoc">Template class for specifying the size of an image or rectangle.</div><div class="ttdef"><b>Definition:</b> types.hpp:335</div></div>
<div class="ttc" id="aclasscv_1_1Vec_html"><div class="ttname"><a href="../../d6/dcf/classcv_1_1Vec.html">cv::Vec</a></div><div class="ttdoc">Template class for short numerical vectors, a partial case of Matx.</div><div class="ttdef"><b>Definition:</b> matx.hpp:369</div></div>
<div class="ttc" id="agroup__core__hal__interface_html_ga32b18d904ee2b1731a9416a8eef67d06"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a></div><div class="ttdeci">#define CV_8U</div><div class="ttdef"><b>Definition:</b> interface.h:73</div></div>
<div class="ttc" id="agroup__imgproc__colormap_html_gga9a805d8262bcbe273f16be9ea2055a65ab3f207661ddf74511b002b1acda5ec09"><div class="ttname"><a href="../../d3/d50/group__imgproc__colormap.html#gga9a805d8262bcbe273f16be9ea2055a65ab3f207661ddf74511b002b1acda5ec09">cv::COLORMAP_JET</a></div><div class="ttdeci">@ COLORMAP_JET</div><div class="ttdef"><b>Definition:</b> imgproc.hpp:4475</div></div>
<div class="ttc" id="agroup__imgproc__transform_html_ga47a974309e9102f5f08231edc7e7529d"><div class="ttname"><a href="../../da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">cv::resize</a></div><div class="ttdeci">void resize(InputArray src, OutputArray dst, Size dsize, double fx=0, double fy=0, int interpolation=INTER_LINEAR)</div><div class="ttdoc">Resizes an image.</div></div>
<div class="ttc" id="agroup__videoio__flags__base_html_gga023786be1ee68a9105bf2e48c700294da38a8d4494036d9a1cc3227dee9189755"><div class="ttname"><a href="../../d4/d15/group__videoio__flags__base.html#gga023786be1ee68a9105bf2e48c700294da38a8d4494036d9a1cc3227dee9189755">cv::CAP_OBSENSOR</a></div><div class="ttdeci">@ CAP_OBSENSOR</div><div class="ttdoc">For Orbbec 3D-Sensor device/module (Astra+, Femto, Astra2, Gemini2, Gemini2L, Gemini2XL,...</div><div class="ttdef"><b>Definition:</b> videoio.hpp:131</div></div>
<div class="ttc" id="agroup__videoio__flags__others_html_gga2ff9f67357f1cb986aaebe6df07609c0a12a6e2e3565fe407ced536bbe97b9df8"><div class="ttname"><a href="../../dc/dfc/group__videoio__flags__others.html#gga2ff9f67357f1cb986aaebe6df07609c0a12a6e2e3565fe407ced536bbe97b9df8">cv::CAP_PROP_OBSENSOR_INTRINSIC_FY</a></div><div class="ttdeci">@ CAP_PROP_OBSENSOR_INTRINSIC_FY</div><div class="ttdef"><b>Definition:</b> videoio.hpp:701</div></div>
<div class="ttc" id="agroup__videoio__flags__others_html_gga2ff9f67357f1cb986aaebe6df07609c0a14ae456d33d9c7a3504c20a9b732d73d"><div class="ttname"><a href="../../dc/dfc/group__videoio__flags__others.html#gga2ff9f67357f1cb986aaebe6df07609c0a14ae456d33d9c7a3504c20a9b732d73d">cv::CAP_PROP_OBSENSOR_INTRINSIC_CX</a></div><div class="ttdeci">@ CAP_PROP_OBSENSOR_INTRINSIC_CX</div><div class="ttdef"><b>Definition:</b> videoio.hpp:702</div></div>
<div class="ttc" id="agroup__videoio__flags__others_html_gga2ff9f67357f1cb986aaebe6df07609c0a7900cc86b5736aa1d92ddec0b17aaf10"><div class="ttname"><a href="../../dc/dfc/group__videoio__flags__others.html#gga2ff9f67357f1cb986aaebe6df07609c0a7900cc86b5736aa1d92ddec0b17aaf10">cv::CAP_PROP_OBSENSOR_INTRINSIC_CY</a></div><div class="ttdeci">@ CAP_PROP_OBSENSOR_INTRINSIC_CY</div><div class="ttdef"><b>Definition:</b> videoio.hpp:703</div></div>
<div class="ttc" id="agroup__videoio__flags__others_html_gga2ff9f67357f1cb986aaebe6df07609c0aa6349f9f91b3a6d1c694cb9d2ce5f300"><div class="ttname"><a href="../../dc/dfc/group__videoio__flags__others.html#gga2ff9f67357f1cb986aaebe6df07609c0aa6349f9f91b3a6d1c694cb9d2ce5f300">cv::CAP_PROP_OBSENSOR_INTRINSIC_FX</a></div><div class="ttdeci">@ CAP_PROP_OBSENSOR_INTRINSIC_FX</div><div class="ttdef"><b>Definition:</b> videoio.hpp:700</div></div>
<div class="ttc" id="agroup__videoio__flags__others_html_gga8fe46fdad857ac6af313a35209995686a4ad7df0545b33819550da2949c996bf4"><div class="ttname"><a href="../../dc/dfc/group__videoio__flags__others.html#gga8fe46fdad857ac6af313a35209995686a4ad7df0545b33819550da2949c996bf4">cv::CAP_OBSENSOR_BGR_IMAGE</a></div><div class="ttdeci">@ CAP_OBSENSOR_BGR_IMAGE</div><div class="ttdoc">Data given from BGR stream generator.</div><div class="ttdef"><b>Definition:</b> videoio.hpp:685</div></div>
<div class="ttc" id="agroup__videoio__flags__others_html_gga8fe46fdad857ac6af313a35209995686ad4631abb061c47f1508f3cbb304ddfcd"><div class="ttname"><a href="../../dc/dfc/group__videoio__flags__others.html#gga8fe46fdad857ac6af313a35209995686ad4631abb061c47f1508f3cbb304ddfcd">cv::CAP_OBSENSOR_DEPTH_MAP</a></div><div class="ttdeci">@ CAP_OBSENSOR_DEPTH_MAP</div><div class="ttdoc">Depth values in mm (CV_16UC1)</div><div class="ttdef"><b>Definition:</b> videoio.hpp:684</div></div>
<div class="ttc" id="ahighgui_8hpp_html"><div class="ttname"><a href="../../d4/dd5/highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="aimgproc_2include_2opencv2_2imgproc_8hpp_html"><div class="ttname"><a href="../../d1/d4f/imgproc_2include_2opencv2_2imgproc_8hpp.html">imgproc.hpp</a></div></div>
<div class="ttc" id="anamespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdoc">&quot;black box&quot; representation of the file storage associated with a file on disk.</div><div class="ttdef"><b>Definition:</b> affine.hpp:52</div></div>
<div class="ttc" id="avideoio_8hpp_html"><div class="ttname"><a href="../../dc/d3d/videoio_8hpp.html">videoio.hpp</a></div></div>
</div><!-- fragment -->  </div> <h2><a class="anchor" id="autotoc_md81"></a>
Code Explanation</h2>
<h3><a class="anchor" id="autotoc_md82"></a>
Python</h3>
<ul>
<li><b>Open Orbbec Depth Sensor</b>: Using <code><a class="el" href="../../d8/dfe/classcv_1_1VideoCapture.html" title="Class for video capturing from video files, image sequences or cameras.">cv.VideoCapture</a>(0, <a class="el" href="../../d4/d15/group__videoio__flags__base.html#gga023786be1ee68a9105bf2e48c700294da38a8d4494036d9a1cc3227dee9189755" title="For Orbbec 3D-Sensor device/module (Astra+, Femto, Astra2, Gemini2, Gemini2L, Gemini2XL,...">cv.CAP_OBSENSOR</a>)</code> to attempt to open the first Orbbec depth sensor device. If the camera fails to open, the program will exit and display an error message.</li>
<li><b>Loop to Grab and Process Data</b>: In an infinite loop, the code continuously grabs data from the camera. The <code>orbbec_cap.grab()</code> method attempts to grab a frame.</li>
<li><b>Process BGR Image</b>: Using <code>orbbec_cap.retrieve(None, <a class="el" href="../../dc/dfc/group__videoio__flags__others.html#gga8fe46fdad857ac6af313a35209995686a4ad7df0545b33819550da2949c996bf4" title="Data given from BGR stream generator.">cv.CAP_OBSENSOR_BGR_IMAGE</a>)</code> to retrieve the BGR image data. If successfully retrieved, the BGR image is displayed in a window using <code><a class="el" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563" title="Displays an image in the specified window.">cv.imshow</a>("BGR", bgr_image)</code>.</li>
<li><b>Process Depth Image</b>: Using <code>orbbec_cap.retrieve(None, <a class="el" href="../../dc/dfc/group__videoio__flags__others.html#gga8fe46fdad857ac6af313a35209995686ad4631abb061c47f1508f3cbb304ddfcd" title="Depth values in mm (CV_16UC1)">cv.CAP_OBSENSOR_DEPTH_MAP</a>)</code> to retrieve the depth image data. If successfully retrieved, the depth image is first normalized to a range of 0 to 255, then a false color image is applied, and the result is displayed in a window using <code><a class="el" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563" title="Displays an image in the specified window.">cv.imshow</a>("DEPTH", color_depth_map)</code>.</li>
<li><b>Keyboard Interrupt</b>: Using <code><a class="el" href="../../d7/dfc/group__highgui.html#ga6d20fbd3100ec3badc1eaa653aff99d7" title="Polls for a pressed key.">cv.pollKey()</a></code> to detect keyboard events. If a key is pressed, the loop breaks and the program ends.</li>
<li><b>Release Resources</b>: After exiting the loop, the camera resources are released using <code>orbbec_cap.release()</code>.</li>
</ul>
<h3><a class="anchor" id="autotoc_md83"></a>
C++</h3>
<ul>
<li><b>Open Orbbec Depth Sensor</b>: Using <code>VideoCapture obsensorCapture(0, CAP_OBSENSOR)</code> to attempt to open the first Orbbec depth sensor device. If the camera fails to open, an error message is displayed, and the program exits.</li>
<li><b>Retrieve Camera Intrinsic Parameters</b>: Using <code><a class="el" href="../../d3/dce/namespacecv_1_1util.html#a71f02f915a836dd4fa73b9dbc76d297b">obsensorCapture.get()</a></code> to retrieve the intrinsic parameters of the camera, including focal lengths (<code>fx</code>, <code>fy</code>) and principal points (<code>cx</code>, <code>cy</code>).</li>
<li><b>Loop to Grab and Process Data</b>: In an infinite loop, the code continuously grabs data from the camera. The <code>obsensorCapture.grab()</code> method attempts to grab a frame.</li>
<li><b>Process BGR Image</b>: Using <code>obsensorCapture.retrieve(image, CAP_OBSENSOR_BGR_IMAGE)</code> to retrieve the BGR image data. If successfully retrieved, the BGR image is displayed in a window using <code>imshow("BGR", image)</code>.</li>
<li><b>Process Depth Image</b>: Using <code>obsensorCapture.retrieve(depthMap, CAP_OBSENSOR_DEPTH_MAP)</code> to retrieve the depth image data. If successfully retrieved, the depth image is normalized and a false color image is applied, then the result is displayed in a window using <code>imshow("DEPTH", adjDepthMap)</code>. The retrieved depth values are in millimeters and are truncated to a range between 300 and 5000 (millimeter). This fixed range can be interpreted as a truncation based on the depth camera's depth range, removing invalid pixels on the depth map.</li>
<li><b>Overlay Depth Map on BGR Image</b>: Convert the depth map to an 8-bit image, resize it to match the BGR image size, and overlay it on the BGR image with a specified transparency (<code>alpha</code>). The overlaid image is displayed in a window using <code>imshow("DepthToColor", image)</code>.</li>
<li><b>Keyboard Interrupt</b>: Using <code><a class="el" href="../../d7/dfc/group__highgui.html#ga6d20fbd3100ec3badc1eaa653aff99d7" title="Polls for a pressed key.">pollKey()</a></code> to detect keyboard events. If a key is pressed, the loop breaks and the program ends.</li>
<li><b>Release Resources</b>: After exiting the loop, the camera resources are released. </li>
</ul>
<h2><a class="anchor" id="autotoc_md84"></a>
Results</h2>
<h3><a class="anchor" id="autotoc_md85"></a>
Python</h3>
<p><img src="../../orbbec_uvc_python.jpg" alt="" class="inline" title="BGR And DEPTH frame"/></p>
<h3><a class="anchor" id="autotoc_md86"></a>
C++</h3>
<p><img src="../../orbbec_uvc_cpp.jpg" alt="" class="inline" title="BGR And DEPTH And DepthToColor frame"/></p>
<h2><a class="anchor" id="autotoc_md87"></a>
Note</h2>
<p>Mac users need sudo privileges to execute the code. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.1
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
